<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Colabìœ¼ë¡œ íŒŒì¸íŠœë‹ Fine-Tuning í•˜ê¸° | Rachel Docs</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Colabìœ¼ë¡œ íŒŒì¸íŠœë‹ Fine-Tuning í•˜ê¸°" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="ì´ ê¸€ì€ ì—°ì„¸ëŒ€í•™êµ AIC3110 ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì˜€ìœ¼ë©°, í—ˆê°€ í•˜ì— ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤." /> <meta property="og:description" content="ì´ ê¸€ì€ ì—°ì„¸ëŒ€í•™êµ AIC3110 ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì˜€ìœ¼ë©°, í—ˆê°€ í•˜ì— ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤." /> <link rel="canonical" href="http://localhost:4000/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%B8%ED%8A%9C%EB%8B%9D-Fine-Tuning-%ED%95%98%EA%B8%B0.html" /> <meta property="og:url" content="http://localhost:4000/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%B8%ED%8A%9C%EB%8B%9D-Fine-Tuning-%ED%95%98%EA%B8%B0.html" /> <meta property="og:site_name" content="Rachel Docs" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-12-29T00:00:00+09:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Colabìœ¼ë¡œ íŒŒì¸íŠœë‹ Fine-Tuning í•˜ê¸°" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-29T00:00:00+09:00","datePublished":"2024-12-29T00:00:00+09:00","description":"ì´ ê¸€ì€ ì—°ì„¸ëŒ€í•™êµ AIC3110 ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì˜€ìœ¼ë©°, í—ˆê°€ í•˜ì— ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.","headline":"Colabìœ¼ë¡œ íŒŒì¸íŠœë‹ Fine-Tuning í•˜ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%B8%ED%8A%9C%EB%8B%9D-Fine-Tuning-%ED%95%98%EA%B8%B0.html"},"url":"http://localhost:4000/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%8C%8C%EC%9D%B8%ED%8A%9C%EB%8B%9D-Fine-Tuning-%ED%95%98%EA%B8%B0.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Rachel Docs </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/posts" class="nav-list-link">Posts by Category</a></li><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Rachel Docs" aria-label="Search Rachel Docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/just-the-docs/just-the-docs-template" class="site-button" > Template Repository </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1>Colabìœ¼ë¡œ íŒŒì¸íŠœë‹ Fine-Tuning í•˜ê¸°</h1> <p>ì´ ê¸€ì€ ì—°ì„¸ëŒ€í•™êµ AIC3110 ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì˜€ìœ¼ë©°, í—ˆê°€ í•˜ì— ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p> <p>í”„ë¡¬í”„íŒ…ì— ì´ì–´ íŒŒì¸íŠœë‹ì„ í•´ë³´ë ¤ í•œë‹¤ !</p> <h2 id="1-íŒŒì¸íŠœë‹ì´ë€"> <a href="#1-íŒŒì¸íŠœë‹ì´ë€" class="anchor-heading" aria-labelledby="1-íŒŒì¸íŠœë‹ì´ë€"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. íŒŒì¸íŠœë‹ì´ë€? </h2> <p>íŒŒì¸íŠœë‹ì´ë€ ì²˜ìŒë¶€í„° ë°ì´í„°ë¥¼ ìŒ“ì•„ì„œ í•™ìŠµì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì›ë˜ ìˆë˜ ëª¨ë¸ì„ ëª©ì ì— ë§ê²Œ ì¶”ê°€ì ì¸ ë°ì´í„°ë¥¼ í†µí•´ í•™ìŠµì‹œì¼œ íŠ¹ì • íƒœìŠ¤í¬ë¥¼ ì˜í•  ìˆ˜ ìˆëŠ” ëª¨ë¸ë¡œ ì„±ì¥ì‹œí‚¤ëŠ” ê³¼ì •ì´ë‹¤.</p> <p>ë‹¹ì—°íˆ, high-quality ë°ì´í„°ë“¤ì´ í•„ìš”í•  ê²ƒì´ë‹¤. high-quality ë°ì´í„°ë€ ,, ê±°ì˜ ì™„ì „íˆ real data ì¦‰ ì¸ê°„ ë°ì´í„°ì´ë‹¤. ê·¸ì¹˜ë§Œ ì´ëŸ° ë°ì´í„°ë“¤ì€ ë³´ì•ˆ ë¬¸ì œë„ ìˆê³ , ë¬´ì œí•œ ìƒì„±í•˜ê¸°ë„ ì–´ë µê³ , ê°œì¸ ì‚¬ìƒí™œ ë¬¸ì œë„ ìˆë‹¤.</p> <p>ê·¸ë˜ì„œ ìš”ì¦˜ì€ <strong>synthetic data</strong> ë¥¼ í†µí•´ ëŒ€ì²´í•˜ëŠ” ì¶”ì„¸ì´ë‹¤. LLMì„ í†µí•´ syntheticì„ ë§Œë“¤ì–´ human-generate dataë¥¼ ëŒ€ì²´í•œë‹¤.</p> <p>Prompt Chainingì„ í†µí•´, í° ëª¨ë¸ì„ í†µí•´ ë°ì´í„°ì…‹ì„ ë§Œë“¤ê³  ê·¸ê²ƒì„ ì‘ì€ ëª¨ë¸ì— í•™ìŠµì‹œì¼œë³´ëŠ” ê³¼ì •ì„ ì§„í–‰í•´ë³´ë ¤ í•œë‹¤.</p> <h2 id="2-íŒŒì¸íŠœë‹ì„-í•´ë³´ì"> <a href="#2-íŒŒì¸íŠœë‹ì„-í•´ë³´ì" class="anchor-heading" aria-labelledby="2-íŒŒì¸íŠœë‹ì„-í•´ë³´ì"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. íŒŒì¸íŠœë‹ì„ í•´ë³´ì </h2> <p>ëª©ì ì€, ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡ì„ ë§Œë“œëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ ìš°ì„  ì‹¬ë¦¬ ìƒë‹´ ë°ì´í„°ê°€ í•„ìš”í•  ê²ƒì´ë‹¤.</p> <h3 id="1-ì‹¬ë¦¬-ìƒë‹´ì´-ë¬´ì—‡ì¸ê°€-"> <a href="#1-ì‹¬ë¦¬-ìƒë‹´ì´-ë¬´ì—‡ì¸ê°€-" class="anchor-heading" aria-labelledby="1-ì‹¬ë¦¬-ìƒë‹´ì´-ë¬´ì—‡ì¸ê°€-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> (1) ì‹¬ë¦¬ ìƒë‹´ì´ ë¬´ì—‡ì¸ê°€ ? </h3> <p>ìš°ë¦¬ê°€ ë§Œë“¤ê³ ì í•˜ëŠ” ì‹¬ë¦¬ ìƒë‹´ ë°ì´í„°ëŠ” í˜„ì‹¤ ìƒë‹´ ì‹œë‚˜ë¦¬ì˜¤ë‘ ë¹„ìŠ·í•˜ê²Œ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì´ë‹¤.</p> <p>ê·¸ë ‡ë‹¤ë©´ í˜„ì‹¤ ìƒë‹´ì´ë€ ë¬´ì—‡ì¸ê°€?</p> <ul> <li>Multi-turn ìœ¼ë¡œ ì§„í–‰í•œë‹¤</li> <li>CBT(ì¸ì§€í–‰ë™ì¹˜ë£Œ)ë¥¼ ì ìš©í•œë‹¤</li> </ul> <p>ì‚¬ì‹¤ ëª¨ë“  ì¹˜ë£Œì— ëŒ€í•´ CBTê°€ ê·¼ê±°ê¸°ë°˜ì¹˜ë£Œì¸ ê²ƒì€ ì•„ë‹ˆë‹¤.. (ì•„ì§ ì—°êµ¬ë˜ê³  ìˆëŠ” ë¶„ì•¼ê°€ ë§ìŒ) ê·¸ì¹˜ë§Œ CBTëŠ” ê±°ì˜ ëª¨ë“  ì„ìƒêµ°ì—ê²Œ ì ìš©ë˜ì—ˆì„ ë•Œ ìœ ì˜ë¯¸í•œ íš¨ê³¼ë¥¼ ë‚˜íƒ€ë‚´ê¸° ë•Œë¬¸ì— CBTë¥¼ íŠ¹ì§•ìœ¼ë¡œ ì¡ê³  ê°€ë„ í¬ê²Œ ì„ìƒì  ë¬¸ì œëŠ” ì—†ì„ ê²ƒì´ë¼ê³  ìƒê°ì´ ëœë‹¤</p> <p><strong>PatternReframe</strong>ì´ë¼ëŠ” ë°ì´í„°ì…‹ì„ ì‚¬ìš©í•´ë³¼ ê²ƒì´ë‹¤ (Maddela et al)<strong>.</strong> Persona, Negative Thought, Patters, Reframed Thought 4ê°€ì§€ ìš”ì†Œë¡œ êµ¬ë¶„ë˜ì–´ ìˆë‹¤. ì´ ë°ì´í„°ì…‹ì„ ì´ìš©í•´ì„œ clientë¥¼ ì‹œë®¬ë ˆì´ì…˜í•´ë³´ë ¤ í•œë‹¤. ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì ¸ì™”ë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">persona</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">i love computers. i</span><span class="sh">'</span><span class="s">m very good at math and science . i started working at google last week on self driving car research . i i love logical and rational thinking .</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">thought</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">I was rejected by a woman. I am sure it is because she like tough guys and not nerds.</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">reframes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">I was rejected by a woman but who cares as there</span><span class="sh">'</span><span class="s">s someone for everyone and I can meet others!</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">I was rejected by a woman. I think I will find someone better soon.</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">I was rejected by a woman but thats ok ill find a better match soon!</span><span class="sh">"</span>
        <span class="p">],</span>
        <span class="sh">"</span><span class="s">patterns</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">mental filtering</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">jumping to conclusions: mind reading</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">overgeneralization</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">black-and-white or polarized thinking / all or nothing thinking</span><span class="sh">"</span>
        <span class="p">]</span>
    <span class="p">}</span>
</code></pre></div></div> <p>persona, negative thought ë“±ì˜ ìš”ì†Œë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. negative thought â†’ reframesê°€ CBTì˜ ëª©í‘œë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. patternì˜ ê²½ìš° thoughtì´ í¬í•¨í•˜ê³  ìˆëŠ” ì¸ì§€ ì˜¤ë¥˜ë“¤ì´ë‹¤.</p> <h3 id="2-ì‹¬ë¦¬-ìƒë‹´-ë°ì´í„°ë¥¼-êµ¬ì¡°í™”í•´ë³´ì"> <a href="#2-ì‹¬ë¦¬-ìƒë‹´-ë°ì´í„°ë¥¼-êµ¬ì¡°í™”í•´ë³´ì" class="anchor-heading" aria-labelledby="2-ì‹¬ë¦¬-ìƒë‹´-ë°ì´í„°ë¥¼-êµ¬ì¡°í™”í•´ë³´ì"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> (2) ì‹¬ë¦¬ ìƒë‹´ ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•´ë³´ì </h3> <p>ì‹¬ë¦¬ ìƒë‹´ ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì„¸ë¶„í™”í•˜ì˜€ë‹¤.</p> <ul> <li>Client-side Simulation : LLMì—ê²Œ PatternReframe ê¸°ë°˜ìœ¼ë¡œ ì •ë³´ë¥¼ ì œê³µí•œ ë’¤, ì´ë¥¼ ê°€ì§€ê³  psychology Intake Formì„ ì ì–´ë³´ë„ë¡ í•¨</li> <li>Counselor-side Simulation : Client ìƒí™©ì— ë§ëŠ” CBT ê¸°ë²•ì„ ê³ ë¥´ê³  planí•˜ë„ë¡ í•¨. Plan-and-Solve Promptingì—ì„œ ê·¼ê±°ë¥¼ ì°¾ì„ ìˆ˜ ìˆì„ ê²ƒ</li> <li>Dialogue Generation : Script Modeë¥¼ ì‚¬ìš©í•  ê²ƒ <ul> <li>Script Mode : í•œ ëª¨ë¸ì´ ì–‘ìª½ì˜ ëŒ€í™”ë¥¼ ëª¨ë‘ ìƒì„±í•¨ (ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ê°€ ë‚˜ì˜´) .</li> <li>Two-agent Mode : ë‘ ëª¨ë¸ì´ ê°ê° ì—­í• ì„ ë§¡ì•„ ëŒ€í™”ë¥¼ ìƒì„±í•¨</li> </ul> </li> </ul> <blockquote> <p>Client side simulation (Form í˜•ì„±) â†’ CBT ê¸°ë²• ê³ ë¥´ê¸° â†’ ìƒë‹´ plan â†’ ëŒ€í™” ìƒì„±</p> </blockquote> <p>ì¼ë°˜ì ìœ¼ë¡œ LLMì—ê²Œ í•œ ë²ˆì— ì‹œí‚¤ë©´ ì˜ ëª»í•˜ëŠ” ê²ƒë“¤ì„, íƒœìŠ¤í¬ë¥¼ ì—¬ëŸ¬ ê°œë¡œ ìª¼ê°œê³  í”„ë¡¬í”„íŒ… ê¸°ë²•ì„ í†µí•´ ë” ì¢‹ì€ í’ˆì§ˆì˜ ë°ì´í„°ì…‹ì„ ë§Œë“¤ê¸° ìœ„í•´ ë…¸ë ¥í•œ ê³¼ì •ì´ë¼ê³  ì´í•´í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.</p> <ol> <li>client-side Simulation</li> </ol> <p>ìš°ì„  í´ë¼ì´ì–¸íŠ¸ë¥¼ ëª¨ë¸ë§í•´ë³´ì. ì´ í´ë¼ì´ì–¸íŠ¸ê°€ ì™œ ìƒë‹´í•˜ëŸ¬ ì˜¨ ê²ƒì¸ì§€ ìì„¸íˆ ì ëŠ” ê²ƒì´ë‹¤. Userì˜ ì •ë³´ë¥¼ í†µí•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì •ë³´ë‚˜, ì™œ ìƒë‹´ì— ì™”ìœ¼ë©°, ì–´ë–¤ ë¬¸ì œë¥¼ ê°€ì¡ŒëŠ”ì§€ ë“± ì •ë³´ë“¤ì„ í¬í•¨í•´ì„œ ì ë„ë¡ í•œë‹¤. ì´ëŸ° ì‹ìœ¼ë¡œ exampleì„ ì¤€ í›„, ì´ í˜•ì‹ì— ë”°ë¼ì„œ ì ì–´ì£¼ë„ë¡ í–ˆë‹¤(one-shot). ëª¨ë¸ì€ <code class="language-plaintext highlighter-rouge">llama3-70b-8192</code>ë¥¼ ì´ìš©í–ˆë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Step 1. Client modeling
</span><span class="n">persona</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="sh">'</span><span class="s">persona</span><span class="sh">'</span><span class="p">]</span>
<span class="n">thought</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="sh">'</span><span class="s">thought</span><span class="sh">'</span><span class="p">]</span>
<span class="n">patterns</span> <span class="o">=</span> <span class="n">user_data</span><span class="p">[</span><span class="sh">'</span><span class="s">patterns</span><span class="sh">'</span><span class="p">]</span>

<span class="n">intake_form_generation_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
Thought depicts a situation where cognitive distortions exhibited by the client have caused problems in daily life, and patterns refer to the types of cognitive distortions the client possesses.

Please generate a client intake form ...

1. Basic Information
- occupation, ...

2. Presenting Problem
- What issue/symptoms ... 

3. Reason for Seeking Counseling
- What was the ... 

4. Past History (including medical history)
- Have you experienced ... 

5. Academic/occupational functioning level (attendance, grades/job performance, etc.)
- Interpersonal ... 

6. Is there anyone you can talk to or get help from when you encounter difficulties or problems?

## Example 1
~~~

## Example 2
[Persona]
</span><span class="si">{</span><span class="n">persona</span><span class="si">}</span><span class="s">

[Thought]
</span><span class="si">{</span><span class="n">thought</span><span class="si">}</span><span class="s">

[Patterns]
</span><span class="si">{</span><span class="n">patterns</span><span class="si">}</span><span class="s">

[Client Intake Form]</span><span class="sh">'''</span>

<span class="n">intake_form</span> <span class="o">=</span> <span class="nf">generate_response</span><span class="p">(</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">intake_form_generation_prompt</span><span class="p">,</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">llama3-70b-8192</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">intake_form</span>
</code></pre></div></div> <p>ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ì–´ì„œ ì¤‘ëµì‹œì¼°ë‹¤. ì‚¬ì‹¤ ì§€ê¸ˆ ë‚´ìš© ìì²´ê°€ ì¤‘ìš”í•˜ì§€ëŠ” ì•Šë‹¤.</p> <p>ì´ì œ ì´ ì¸ì§€ì˜¤ë¥˜ë¥¼ ê²ªëŠ” ì‚¬ëŒì—ê²Œ ì–´ë–¤ CBTê°€ ì í•©í• ì§€ ì°¾ëŠ” ê³¼ì •ì„ ì§„í–‰í•´ë³´ì. ì´ë¥¼ <code class="language-plaintext highlighter-rouge">cbt_tech_generation_prompt</code> ë¡œ ì§€ì •í•œë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Step 2. CBT Technique Generation
</span><span class="n">cbt_tech_generation_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
You are a counselor specializing in CBT techniques. Choose top 1 appropriate CBT technique from the given CBT techniques to use with the client based on their intake form. Output only the name of the CBT techniques.

[Types of CBT Techniques]
Efficiency Evaluation, Pie Chart Technique, Alternative Perspective, Decatastrophizing, Pros and Cons Analysis, Evidence-Based Questioning, Reality Testing, Continuum Technique, Changing Rules to Wishes, Behavior Experiment, Problem-Solving Skills Training, Systematic Exposure

## Example 1
[Intake form written by client]
&lt;Reason for Seeking Therapy&gt;
I</span><span class="sh">'</span><span class="s">ve been struggling with my temper, ...

[CBT technique]
Alternative Perspective

## Example 2
[Intake form written by client]
</span><span class="si">{</span><span class="n">intake_form</span><span class="si">}</span><span class="s">

[CBT technique]</span><span class="sh">'''</span>

<span class="n">cbt_tech</span> <span class="o">=</span> <span class="nf">generate_response</span><span class="p">(</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">cbt_tech_generation_prompt</span><span class="p">,</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">llama3-70b-8192</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">cbt_tech</span>
</code></pre></div></div> <p>ì‹¤í–‰ì„ í•´ë³´ë©´, <code class="language-plaintext highlighter-rouge">Evidence-Based Questioning</code> ì´ë¼ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤. ì¦‰, ì´ ìƒí™©ì— ëŒ€í•´ ì ìš©í•  ìˆ˜ ìˆëŠ” CBT ê¸°ë²•ì´ ë°”ë¡œ Evidence-Based Questioningì´ë¼ëŠ” ê²ƒì´ë‹¤. llama ëª¨ë¸ì€ ì‚¬ì „í•™ìŠµëœ ë°ì´í„°ê°€ ìˆê¸°ì— ì´ë¥¼ í™œìš©í•˜ì—¬ ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³ , ê°€ì¥ ì ì ˆí•œ ê²ƒì„ ì„ íƒí•œ ê²ƒì´ë‹¤.</p> <ol> <li>counselor-side Simulation</li> </ol> <p>ì´ì œ êµ¬ì²´ì ì¸ í”Œëœì„ ì§œë³´ì.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Step 3. CBT Planning
</span>
<span class="n">cbt_planning_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
You are a counselor specializing in CBT techniques. Plan to counsel the patient who has completed ... 

## Example 1
[Intake form written by client]
&lt;Reason for Seeking Therapy&gt;
I</span><span class="sh">'</span><span class="s">ve been struggling with ... 

&lt;Goals for Therapy&gt;
I want to find ways to stay ... 

&lt;Cognitive Distortions Observed&gt;
All-or-nothing thinking: The client ... 

[CBT technique]
Decatastrophizing

[Counseling plan]
Decatastrophizing
1. Identify Catastrophic ... 

</span><span class="si">{</span><span class="n">intake_form</span><span class="si">}</span><span class="s">

[CBT technique]
</span><span class="si">{</span><span class="n">cbt_tech</span><span class="si">}</span><span class="s">

[Counseling sequence]
</span><span class="sh">'''</span>

<span class="n">cbt_plan</span> <span class="o">=</span> <span class="nf">generate_response</span><span class="p">(</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">cbt_planning_prompt</span><span class="p">,</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">llama3-70b-8192</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">cbt_plan</span>
</code></pre></div></div> <p>ì•„ì£¼ ì¢‹ì€ ê²°ê³¼ë¥¼ ë‚´ì¤€ë‹¤.</p> <ol> <li>dialogue ì œì‘</li> </ol> <p>ì´ë¥¼ ê°€ì§€ê³  dialogueë¥¼ ë§Œë“¤ì–´ ë³¼ ê²ƒì´ë‹¤</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Step 4. Dialogue generation
</span>
<span class="n">dialogue_generation_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
Your task is to generate a multi-turn counseling dialogue between a client and a professional counselor. Generate a dialogue that incorporates the following guidelines:

# General guidelines
1. The dialogue is ...

# Guidelines for the participants
## Guidelines for the counselor</span><span class="sh">'</span><span class="s">s utterance:
1. At the start of the conversation, ...

## Guidelines for the client</span><span class="sh">'</span><span class="s">s utterance:
1. Engage authentically with the counselor</span><span class="sh">'</span><span class="s">s inquiries ... 

[Situation of the client]
</span><span class="si">{</span><span class="n">intake_form</span><span class="si">}</span><span class="s">

[Counseling plan]
</span><span class="si">{</span><span class="n">cbt_plan</span><span class="si">}</span><span class="s">

Remember that you are an independent dialogue writer and should finish the dialogue by yourself.

[Generated dialogue]
</span><span class="sh">'''</span>

<span class="n">dialogue</span> <span class="o">=</span> <span class="nf">generate_response</span><span class="p">(</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">dialogue_generation_prompt</span><span class="p">,</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">llama3-70b-8192</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">dialogue</span>
</code></pre></div></div> <p>ê·¸ëŸ¬ë©´ ë©€í‹°í„´ ëŒ€í™”ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.</p> <p>ë³´ë©´ ì•Œê² ì§€ë§Œ, ì§€ë‚œ ë²ˆì— ë§Œë“¤ì—ˆë˜ generate_response í•¨ìˆ˜ì— í”„ë¡¬í¬íŠ¸ì™€ ëª¨ë¸ëª…ì„ ë„£ì–´ì„œ ê·¸ëƒ¥ ê³„ì† ìƒì„±í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì˜ˆì‹œë¥¼ í•œê°œì”© ì£¼ê³  ìˆìœ¼ë‹ˆ one-shotì´ ë˜ê² ë‹¤. ì–´ë µì§€ ì•Šì€ ê³¼ì •ì´ì§€ë§Œ, í”„ë¡¬í¬íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ì„ìƒ/ìƒë‹´ ì „ë¬¸ê°€ê°€ í•„ìš”í•˜ê² ë‹¤.</p> <h3 id="3-íŒŒì¸íŠœë‹-ì „-ê¸°ë³¸-ì‘ì—…ë“¤"> <a href="#3-íŒŒì¸íŠœë‹-ì „-ê¸°ë³¸-ì‘ì—…ë“¤" class="anchor-heading" aria-labelledby="3-íŒŒì¸íŠœë‹-ì „-ê¸°ë³¸-ì‘ì—…ë“¤"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> (3) íŒŒì¸íŠœë‹ ì „ ê¸°ë³¸ ì‘ì—…ë“¤ </h3> <p>ëª¨ë¸ì€ LLaMa2-7b , ë°ì´í„°ì…‹ì€ Cactusë¥¼ ì‚¬ìš©í•œë‹¤ (https://huggingface.co/datasets/DLI-Lab/cactus). CactusëŠ” ìœ„ì˜ ê³¼ì •ì„ ê³„ì† ë°˜ë³µí•˜ì—¬ ìƒì„±ëœ ë°ì´í„°ì…‹ì´ë‹¤.</p> <p>ìš°ì„  í•„ìš”í•œ ìë£Œë“¤ì„ ì„¤ì¹˜í•´ì¤€ë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">U</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">huggingface</span><span class="o">/</span><span class="n">transformers</span><span class="p">.</span><span class="n">git</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">U</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">huggingface</span><span class="o">/</span><span class="n">peft</span><span class="p">.</span><span class="n">git</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">U</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">huggingface</span><span class="o">/</span><span class="n">accelerate</span><span class="p">.</span><span class="n">git</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">trl</span> <span class="n">xformers</span> <span class="n">wandb</span> <span class="n">datasets</span> <span class="n">einops</span> <span class="n">gradio</span> <span class="n">sentencepiece</span> <span class="n">bitsandbytes</span>

<span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">DLI-Lab/cactus</span><span class="sh">"</span><span class="p">,</span><span class="n">split</span><span class="o">=</span><span class="sh">'</span><span class="s">train</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <p>íŒŒì¸íŠœë‹ì„ í•  ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ GPUê°€ ë§ì´ ë“¤ê¸° ë•Œë¬¸ì—, ë”± 10ê°œ ë°ì´í„°ë§Œ ê°€ì§€ê³  í•™ìŠµì„ ì§„í–‰í•´ë³¼ ê²ƒì´ë‹¤. <code class="language-plaintext highlighter-rouge">train_dataset</code> í•œ ê°œ í•œ ê°œë¥¼ ë³´ë©´ ì•„ê¹Œ ëŒì•˜ë˜ ì‚¬ì´í´ (client-side, counselor-sideë¡œ ë§Œë“  multi-turn dialogue) ì´ ì˜ ì €ì¥ë˜ì–´ ìˆë‹¤.</p> <p>ì§€ê¸ˆê¹Œì§€ì˜ dialogue historyê°€ ì£¼ì–´ì¡Œì„ ë•Œ, ê·¸ê±¸ ë°”íƒ•ìœ¼ë¡œ counselorì´ ì í•©í•œ ëŒ€ë‹µì„ í•˜ëŠ” ê±¸ í•™ìŠµí•˜ëŠ” ë°©ì‹ì„ í†µí•´ ìƒë‹´ ì±—ë´‡ì„ ë§Œë“¤ì–´ë³¸ë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[:</span><span class="mi">10</span><span class="p">][</span><span class="sh">'</span><span class="s">dialogue</span><span class="sh">'</span><span class="p">]</span>
<span class="n">refined_dataset</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dialogue</span> <span class="ow">in</span> <span class="n">train_dataset</span><span class="p">:</span>
  <span class="n">splited_dialogue</span> <span class="o">=</span> <span class="n">dialogue</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">splited_dialogue</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">dialogue_history</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">splited_dialogue</span><span class="p">[:</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">response</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">splited_dialogue</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">refined_dataset</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">refined_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div> <p>refined_datasetì„ ë³´ë©´ ì´ì œ â€˜dialogue_historyâ€™ì™€ â€˜responseâ€™ë¡œ ë‚˜ë‰˜ì–´ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì €ì¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ëŸ° ì‹ìœ¼ë¡œ ..</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'dialogue_history': "Counselor: Good afternoon, Brooke. Thank you for joining me today. Can you tell me a bit about what brings you to counseling?Client: Hi. I've been really anxious about going back to the animal shelter where I volunteer. I feel like the animals will hate me because they didn't remember me the last time I visited. It's been really tough.",
 'response': "Counselor: I'm sorry to hear that you've been feeling this way. It sounds like this is something thatâ€™s been troubling you for a while. Can you tell me more about what happened during your last visit to the shelter?"}
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_data_module</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">System_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">You are playing the role of a counselor in a psychological counseling session. Your task is to generate the next counselor utterance in the dialogue. The goal is to create a natural and engaging response that builds on the previous conversation.</span><span class="sh">"</span>
  <span class="n">User_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Counseling Dialogue History:</span><span class="se">\n</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">dialogue_history</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>
  <span class="n">output_text</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="sh">'</span><span class="s">response</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>
  <span class="n">input_text</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">System_prompt</span><span class="si">}</span><span class="s">&lt;|eot_id|&gt;&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">User_prompt</span><span class="si">}</span><span class="s">&lt;|eot_id|&gt;&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</span><span class="se">\n\n</span><span class="sh">"</span>
  <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">:</span> <span class="n">input_text</span><span class="p">,</span> <span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">:</span> <span class="n">output_text</span><span class="p">}</span>

<span class="n">transformed_dataset</span> <span class="o">=</span> <span class="p">[</span><span class="nf">make_data_module</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">refined_dataset</span><span class="p">]</span>
</code></pre></div></div> <h3 id="4-íŒŒì¸íŠœë‹-ì§„ì§œ-í•´ë³´ì"> <a href="#4-íŒŒì¸íŠœë‹-ì§„ì§œ-í•´ë³´ì" class="anchor-heading" aria-labelledby="4-íŒŒì¸íŠœë‹-ì§„ì§œ-í•´ë³´ì"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> (4) íŒŒì¸íŠœë‹ ì§„ì§œ í•´ë³´ì </h3> <p>ì´ì œ ì§„ì§œë¡œ íŒŒì¸íŠœë‹ì„ í•´ë³´ì. ë¨¼ì € hugging faceì—ì„œ apië¥¼ ë°›ì•„ì„œ ì˜¤ì.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">huggingface_hub</span> <span class="kn">import</span> <span class="n">notebook_login</span>
<span class="nf">notebook_login</span><span class="p">()</span>
</code></pre></div></div> <p>ì‹¤í–‰í•˜ë©´ ë‚˜ì˜¤ëŠ” ì¹¸ì— LLAMA api keyë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.</p> <p>ëª¨ë¸ì€ <code class="language-plaintext highlighter-rouge">Llama-2-7b-hf</code> ë¥¼ ì‚¬ìš©í•´ë³´ê² ë‹¤ (ë‹¤ë¥¸ ê±° ì¨ë„ ëœë‹¤.)</p> <p>LLaMA-2 ëª¨ë¸ì„ 4ë¹„ì¸  ì–‘ìí™”ì™€ LoRAë¥¼ ì‚¬ìš©í•´ì„œ í›ˆë ¨í•˜ëŠ” ë°©ì‹ì´ë‹¤. (ë³´í†µ LoRAëŠ” ë¯¸ì„¸ì¡°ì • ì‹œ ë§ì´ ì‚¬ìš©í•˜ê³  ì ì€ ë¦¬ì†ŒìŠ¤ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í›ˆë ¨í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤)</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">meta-llama/Llama-2-7b-hf</span><span class="sh">"</span>

<span class="kn">from</span> <span class="n">transformers</span> <span class="kn">import</span> <span class="n">AutoModelForCausalLM</span><span class="p">,</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">BitsAndBytesConfig</span>
<span class="kn">from</span> <span class="n">peft</span> <span class="kn">import</span> <span class="n">prepare_model_for_kbit_training</span><span class="p">,</span> <span class="n">LoraConfig</span><span class="p">,</span> <span class="n">get_peft_model</span><span class="p">,</span> <span class="n">PeftModel</span>
<span class="kn">import</span> <span class="n">torch</span>

<span class="n">bnb_config</span> <span class="o">=</span> <span class="nc">BitsAndBytesConfig</span><span class="p">(</span>
    <span class="n">load_in_4bit</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">bnb_4bit_quant_type</span><span class="o">=</span> <span class="sh">"</span><span class="s">nf4</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">bnb_4bit_compute_dtype</span><span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">float16</span><span class="p">,</span>
    <span class="n">bnb_4bit_use_double_quant</span><span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForCausalLM</span><span class="p">.</span><span class="nf">from_pretrained</span><span class="p">(</span>
    <span class="n">model_name</span><span class="p">,</span>
    <span class="n">quantization_config</span><span class="o">=</span><span class="n">bnb_config</span><span class="p">,</span>
    <span class="n">device_map</span><span class="o">=</span><span class="p">{</span><span class="sh">""</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="nf">prepare_model_for_kbit_training</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">use_cache</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># silence the warnings. Please re-enable for inference!
</span><span class="n">model</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">pretraining_tp</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Load LLaMA tokenizer
</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="nf">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="p">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">.</span><span class="n">eos_token</span>
<span class="n">tokenizer</span><span class="p">.</span><span class="n">add_eos_token</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">tokenizer</span><span class="p">.</span><span class="n">add_bos_token</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">.</span><span class="n">add_eos_token</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">bnb_config</code> ëŠ” 4ë¹„íŠ¸ ì–‘ìí™”ë¥¼ í†µí•´ ëª¨ë¸ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ê³ , nf4ë¥¼ í†µí•´ ì–‘ìí™” ìœ í˜•ì„ ì •í•´ì£¼ì—ˆìœ¼ë©° torch.float16ìœ¼ë¡œ ê³„ì‚° ë°ì´í„° ìœ í˜•ì„ ì§€ì •í•˜ì˜€ë‹¤.</p> <p><code class="language-plaintext highlighter-rouge">AutoModelForCausalLM.from_pretrained</code> ë¥¼ í†µí•´ ì‚¬ì „ í•™ìŠµëœ ì–¸ì–´ ëª¨ë¸ì„ ë¡œë“œí–ˆê³ , <code class="language-plaintext highlighter-rouge">quantization_config=bnb_config</code> ë¥¼ í†µí•´ ì•„ê¹Œ ì„¤ì •í•´ë‘” 4ë¹„íŠ¸ ì–‘ìí™”ë¥¼ ì ìš©í–ˆë‹¤. <code class="language-plaintext highlighter-rouge">device_map={"": 0}</code> ì„ í†µí•´ ëª¨ë¸ì„ GPUì— ë¡œë“œí•˜ë„ë¡ í–ˆë‹¤.</p> <p><code class="language-plaintext highlighter-rouge">add_eos_token</code><strong>,</strong> <code class="language-plaintext highlighter-rouge">add_bos_token</code> ì„ í†µí•´ ë¬¸ì¥ì˜ ì‹œì‘ê³¼ ëì„ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ë„ë¡ í–ˆë‹¤.</p> <p>LoRA ì„¤ì •ì„ ìœ„í•´ ì„¸ë¶€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì§€ì •í•˜ê³ , TrainingArguments í´ë˜ìŠ¤ë¡œ ëª¨ë¸ í›ˆë ¨ì„ ìœ„í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•œë‹¤. ê·¸ë¦¬ê³  ì‚¬ì „ í•™ìŠµëœ ëª¨ë¸ì„ LoRA ê¸°ë°˜ìœ¼ë¡œ ë¯¸ì„¸ ì¡°ì •í•˜ëŠ” ì„¤ì •ì„ êµ¬í˜„í•œë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">transformers</span> <span class="kn">import</span> <span class="n">TrainingArguments</span> 

<span class="n">peft_config</span> <span class="o">=</span> <span class="nc">LoraConfig</span><span class="p">(</span>
    <span class="n">lora_alpha</span><span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">lora_dropout</span><span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">r</span><span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
    <span class="n">bias</span><span class="o">=</span><span class="sh">"</span><span class="s">none</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">task_type</span><span class="o">=</span><span class="sh">"</span><span class="s">CAUSAL_LM</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">target_modules</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">q_proj</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">k_proj</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">v_proj</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">o_proj</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">gate_proj</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">up_proj</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">training_arguments</span> <span class="o">=</span> <span class="nc">TrainingArguments</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="o">=</span> <span class="sh">"</span><span class="s">./results</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">num_train_epochs</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">per_device_train_batch_size</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">#ê¸°ë³¸ê°’: 8 (ì½”ë©ì—ì„œ ëŒì•„ê°€ë„ë¡ í•˜ë ¤ë©´ 1ì´ ì¢‹ë‹¤) 
</span>    <span class="n">gradient_accumulation_steps</span><span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">optim</span> <span class="o">=</span> <span class="sh">"</span><span class="s">paged_adamw_8bit</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">save_steps</span><span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">logging_steps</span><span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span> <span class="mf">2e-4</span><span class="p">,</span>
    <span class="n">weight_decay</span><span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">fp16</span><span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">bf16</span><span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">max_grad_norm</span><span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">max_steps</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">warmup_ratio</span><span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">group_by_length</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">lr_scheduler_type</span><span class="o">=</span> <span class="sh">"</span><span class="s">linear</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">report_to</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">none</span><span class="sh">"</span><span class="p">]</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="n">trl</span> <span class="kn">import</span> <span class="n">SFTTrainer</span>

<span class="n">hf_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">.</span><span class="nf">from_dict</span><span class="p">({</span>
    <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">input</span><span class="sh">'</span><span class="p">]</span><span class="si">}{</span><span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">output</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">transformed_dataset</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="nc">SFTTrainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">hf_dataset</span><span class="p">,</span>
    <span class="n">peft_config</span><span class="o">=</span><span class="n">peft_config</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="n">training_arguments</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div> <p>ëª¨ë“  ì„¤ì •ì„ ëëƒˆìœ¼ë‹ˆ ì´ì œ í›ˆë ¨ì„ í•´ë³¼ê²ƒì´ë‹¤. ìš°ë¦¬ì˜ ëª¨ë“  ì„¤ì •ì„ í¬í•¨í•˜ê³  ìˆëŠ” <code class="language-plaintext highlighter-rouge">trainer</code> ì„ ì´ìš©í•œë‹¤.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trainer</span><span class="p">.</span><span class="nf">train</span><span class="p">()</span>
</code></pre></div></div> <p>ë°ì´í„° ì–‘ì´ ì ì–´ì„œ í•œ 20ë¶„ì´ë©´ ëë‚œë‹¤.</p><hr /> <h3> <a href="#4-íŒŒì¸íŠœë‹-ì§„ì§œ-í•´ë³´ì" class="anchor-heading" aria-labelledby="4-íŒŒì¸íŠœë‹-ì§„ì§œ-í•´ë³´ì"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ”— Related Posts in NLP </h3> <ul> <li><a href="/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%94%84%EB%A1%AC%ED%94%84%ED%8C%85-Prompting-%ED%95%98%EA%B8%B0.html">Colabìœ¼ë¡œ í”„ë¡¬í”„íŒ… Prompting í•˜ê¸°</a> (2024-12-29)</li> </ul> <nav class="post-nav"> <a class="next" href="/nlp/2024/12/29/Colab%EC%9C%BC%EB%A1%9C-%ED%94%84%EB%A1%AC%ED%94%84%ED%8C%85-Prompting-%ED%95%98%EA%B8%B0.html">Colabìœ¼ë¡œ í”„ë¡¬í”„íŒ… Prompting í•˜ê¸° â†’</a> </nav> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
